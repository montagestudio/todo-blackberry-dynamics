montageDefine("a5e4c02","core/services/blackberry-service",{dependencies:[],factory:function(o,e,n){var t=function(){this.config={database:{name:"Database",version:"1.0",displayname:"ToDoBBD Demo",size:2e5,success:function(){console.log("DB is opened")},error:function(){console.log("Error: "),console.log(arguments[0]),console.log(arguments[1])},insert:function(o,e){console.log(e)}}},this.db=null,this.todos=[]};t.prototype.openDatabase=function(){var o=this.config,e=this;return this.db=window.openDatabase(o.database.name,o.database.version,o.database.displayname,o.database.size,o.database.success,o.database.error),new Promise(function(n,t){e.db.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS Todos;"),e.executeSql("CREATE TABLE IF NOT EXISTS Todos( id INTEGER PRIMARY KEY NOT NULL, label VARCHAR(255), done BOOLEAN); ",[],null,o.database.error),e.executeSql('INSERT INTO Todos (label, done) VALUES ("My To-do 001", 1);',[],null,o.database.error),e.executeSql('INSERT INTO Todos (label, done) VALUES ("My To-do 002", 0);',[],null,o.database.error)},t,n)})},t.prototype.fetchAll=function(){var o=this;return new Promise(function(e,n){o.db.transaction(function(e){e.executeSql("SELECT * FROM Todos;",[],function(e,n){for(var t,a=n.rows,i=o.todos,s=0,r=a.length;s<r;s++)t=a.item(s),i.push({id:t.id,label:t.label,done:!!t.done})})},n,function(){e(o.todos)})})},t.prototype.deleteTodo=function(o){var e=this;return new Promise(function(n,t){e.db.transaction(function(n){n.executeSql("DELETE FROM Todos WHERE id = ?",[o.id],function(){for(var n=e.todos,t=o.id,a=0,i=n.length;a<i;a++)if(n[a].id===t){n.splice(a,1);break}})},t,n)})},t.prototype.addTodo=function(o){var e=this;return e.todos.push(o),new Promise(function(n,t){e.db.transaction(function(e){e.executeSql("INSERT INTO Todos (label, done) VALUES (?, ?);",[o.label,o.done?1:0],function(e,n){o.id=n.insertId})},t,function(){n(o)})})},t.prototype.updateTodo=function(o,e){var n=this;return new Promise(function(t,a){n.db.transaction(function(n){n.executeSql("UPDATE Todos SET done = ? WHERE id = ?",[e.done?1:0,o.id],function(n,t){for(var a,i=Object.keys(e),s=0,r=i.length;s<r;s++)a=i[s],o[a]=e[a]})},a,function(){t(o)})})},e.DataService=t}});